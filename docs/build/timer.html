

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Timer Gadget &mdash; Alexa-Gadgets-Raspberry-Pi-Samples 1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Notification Flag Gadget" href="notification.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Alexa-Gadgets-Raspberry-Pi-Samples
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Python API</a></li>
</ul>
<p class="caption"><span class="caption-text">Projects</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="colorcycler.html">Color Cycler</a></li>
<li class="toctree-l1"><a class="reference internal" href="kitchensink.html">Kitchen Sink</a></li>
<li class="toctree-l1"><a class="reference internal" href="wakeword.html">Wake Word</a></li>
<li class="toctree-l1"><a class="reference internal" href="notification.html">Notification</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Timer</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-1-connect-the-servo-to-your-pi">Step 1: Connect the servo to your Pi</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-2-configure-your-credentials">Step 2: Configure your credentials</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-3-explore-the-example">Step 3: Explore the example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#code">Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#step-4-test-your-gadget">Step 4: Test your gadget</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-5-assemble-your-gadget">Step 5: Assemble your gadget</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-s-next">What’s next</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Alexa-Gadgets-Raspberry-Pi-Samples</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Timer Gadget</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="timer-gadget">
<h1>Timer Gadget<a class="headerlink" href="#timer-gadget" title="Permalink to this headline">¶</a></h1>
<a class="reference external image-reference" href="_static/images/timer_gadget.png"><img alt="Hardware requirements" src="_images/timer_gadget.png" /></a>
<p><strong>This guide steps through the process of creating an Alexa Gadget that reacts to a single timer set on an Echo device. A servo rotates a disc to indicate the remaining duration of the timer, when the timer expires, and when a timer is canceled.</strong></p>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<a class="reference external image-reference" href="_static/images/pi_servo_hardware.png"><img alt="Hardware requirements" src="_images/pi_servo_hardware.png" /></a>
<p>In order to to run this example <strong>you should already have</strong> a Raspberry Pi with the <strong>Alexa-Gadgets-Raspberry-Pi-Samples software</strong> installed. Learn more in the <a class="reference external" href="overview.html">project README</a>. In addition, you will need the following hardware:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.amazon.com/DIKAVS-Break-Away-2x20-pin-Header-Raspberry/dp/B075VNBD3R">Header pins</a> soldered to your Raspberry Pi (used for connecting hardware)</p></li>
<li><p><a class="reference external" href="https://www.amazon.com/MakerDoIt-Micro-Arduino-Walking-Control/dp/B07C5PGD3Q/">Micro servo</a></p></li>
<li><p>Three male-female <a class="reference external" href="https://www.amazon.com/LANDZO-Multicolored-Breadboard-Raspberry-Arduino/dp/B01IB7UOFE/">jumper wires</a></p></li>
</ul>
</div>
<div class="section" id="step-1-connect-the-servo-to-your-pi">
<h2>Step 1: Connect the servo to your Pi<a class="headerlink" href="#step-1-connect-the-servo-to-your-pi" title="Permalink to this headline">¶</a></h2>
<p>The following steps walk you through connecting the servo:</p>
<ol class="arabic simple">
<li><p>Make sure your Raspberry Pi is powered off.</p></li>
<li><p>Connect jumper wires to the 5V, GPIO25 (Pin 22), and GRND pins. <a class="reference external" href="https://www.raspberrypi.org/documentation/usage/gpio/">Learn more</a></p></li>
<li><p>Connect jumper wires to the servo using the diagram below. Red is power, black/brown is ground, and yellow/orange is signal.</p></li>
<li><p>Once you’ve connected the servo to the Pi, start up your Pi.</p></li>
</ol>
<a class="reference external image-reference" href="_static/images/servo_to_rpi.png"><img alt="Servo to Raspberry Pi Diagram" src="_images/servo_to_rpi.png" /></a>
</div>
<div class="section" id="step-2-configure-your-credentials">
<h2>Step 2: Configure your credentials<a class="headerlink" href="#step-2-configure-your-credentials" title="Permalink to this headline">¶</a></h2>
<p>Now that the servo is connected to your Pi, you can continue on with the example.</p>
<p>As with any example, you’ll need to first add the credentials that are associated with the gadget you created in the <a class="reference external" href="https://developer.amazon.com/avs/home.html#/avs/home">Alexa Voice Service Developer Console</a>:</p>
<ol class="arabic simple">
<li><p>On the command line of your Pi, navigate to <code class="docutils literal notranslate"><span class="pre">/home/pi/Alexa-Gadgets-Raspberry-Pi-Samples/src/examples/timer</span></code> and open the <code class="docutils literal notranslate"><span class="pre">timer_gadget.ini</span></code> file within that folder.</p></li>
<li><p>Change the <code class="docutils literal notranslate"><span class="pre">amazonId</span></code> from <code class="docutils literal notranslate"><span class="pre">YOUR_GADGET_AMAZON_ID</span></code> to the <strong>Amazon ID</strong> that is displayed on the gadget’s product page in the Alexa Voice Service Developer Console.</p></li>
<li><p>Change the <code class="docutils literal notranslate"><span class="pre">alexaGadgetSecret</span></code> from <code class="docutils literal notranslate"><span class="pre">YOUR_GADGET_SECRET</span></code> to the <strong>Alexa Gadget Secret</strong> that is displayed on the gadget’s product page in the Alexa Voice Service Developer Console.</p></li>
</ol>
<p>To learn more, refer to <a class="reference external" href="https://developer.amazon.com/docs/alexa-gadgets-toolkit/register-gadget.html">Register a Gadget</a> in the Alexa Gadgets Toolkit documentation.</p>
</div>
<div class="section" id="step-3-explore-the-example">
<h2>Step 3: Explore the example<a class="headerlink" href="#step-3-explore-the-example" title="Permalink to this headline">¶</a></h2>
<p>The example follows the same model as other examples that you can browse within the Alexa-Gadgets-Raspberry-Pi-Samples project.</p>
<div class="section" id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>Within the <code class="docutils literal notranslate"><span class="pre">timer_gadget.ini</span></code> file, in addition to the credentials you just modified, you will see a group of <code class="docutils literal notranslate"><span class="pre">[GadgetCapabilities]</span></code> that this gadget is registering for. In this case, it is registering for <code class="docutils literal notranslate"><span class="pre">StateListener</span></code> and <code class="docutils literal notranslate"><span class="pre">Alerts</span></code>:</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">GadgetCapabilities</span><span class="p">]</span>
<span class="n">Alexa</span><span class="p">.</span><span class="n">Gadget</span><span class="p">.</span><span class="n">StateListener</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">timers</span>
<span class="n">Alerts</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">1</span>
</pre></div>
</div>
<p>In this example, you will be using version 1.0 of the <a class="reference external" href="https://developer.amazon.com/docs/alexa-gadgets-toolkit/alexa-gadget-statelistener-interface.html">StateListener interface</a>, and responding to the <code class="docutils literal notranslate"><span class="pre">timers</span></code> type, as well as using version 1.1 of the <a class="reference external" href="https://developer.amazon.com/docs/alexa-gadgets-toolkit/alerts-interface.html">Alerts interface</a>.</p>
</div>
<div class="section" id="code">
<h3>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h3>
<p>Within <code class="docutils literal notranslate"><span class="pre">timer_gadget.py</span></code> you’ll notice the import and use of Raspberry Pi’s GPIO capabilities using the <a class="reference external" href="https://gpiozero.readthedocs.io">gpiozero</a> library, as well as other packages:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">gpiozero</span> <span class="kn">import</span> <span class="n">AngularServo</span>
<span class="kn">import</span> <span class="nn">dateutil.parser</span>

<span class="kn">from</span> <span class="nn">agt</span> <span class="kn">import</span> <span class="n">AlexaGadget</span>
</pre></div>
</div>
<p>You’ll also see the configuration of servo motor using gpiozero’s AngularServo:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">SERVO</span> <span class="o">=</span> <span class="n">AngularServo</span><span class="p">(</span><span class="n">GPIO_PIN</span><span class="p">,</span> <span class="n">initial_angle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">min_pulse_width</span><span class="o">=</span><span class="mf">0.0005</span><span class="p">,</span> <span class="n">max_pulse_width</span><span class="o">=</span><span class="mf">0.002</span><span class="p">)</span>
</pre></div>
</div>
<p>In addition, you will see callbacks that define what should happen for the set, expiration, and clearing of a timer:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_alerts_setalert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directive</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handles Alerts.SetAlert directive sent from Echo Device</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check that this is a timer. if it is something else (alarm, reminder), just ignore</span>
    <span class="k">if</span> <span class="n">directive</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s1">&#39;TIMER&#39;</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Received SetAlert directive but type != TIMER. Ignorning&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># parse the scheduledTime in the directive. if is already expired, ignore</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">directive</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">scheduledTime</span><span class="p">)</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Received SetAlert directive but scheduledTime has already passed. Ignoring&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># check if this is an update to an alrady running timer (e.g. users asks alexa to add 30s)</span>
    <span class="c1"># if it is, just adjust the end time</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer_token</span> <span class="o">==</span> <span class="n">directive</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">token</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Received SetAlert directive to update to currently running timer. Adjusting&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer_end_time</span> <span class="o">=</span> <span class="n">t</span>
        <span class="k">return</span>

    <span class="c1"># check if another timer is already running. if it is, just ignore this one</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer_thread</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer_thread</span><span class="o">.</span><span class="n">isAlive</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Received SetAlert directive but another timer is already running. Ignoring&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># start a thread to rotate the servo</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Received SetAlert directive. Starting a timer for &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timer_end_time</span> <span class="o">=</span> <span class="n">t</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timer_token</span> <span class="o">=</span> <span class="n">directive</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">token</span>

    <span class="c1"># run timer in it&#39;s own thread to prevent blocking future directives during count down</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timer_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_timer</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timer_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">on_alerts_deletealert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directive</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handles Alerts.DeleteAlert directive sent from Echo Device</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check if this is for the currently running timer. if not, just ignore</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer_token</span> <span class="o">!=</span> <span class="n">directive</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">token</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Received DeleteAlert directive but not for the currently active timer. Ignoring&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># delete the timer, and stop the currently running timer thread</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Received DeleteAlert directive. Cancelling the timer&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timer_token</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>
</div>
<p>You’ll also see code for controlling the rotation of the servo to indicate the remaining duration of the timer, and when a timer has expired or cleared:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_run_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs a timer</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check every 200ms if we should rotate the servo</span>
    <span class="n">cur_angle</span> <span class="o">=</span> <span class="mi">180</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">time_remaining</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer_end_time</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_set_servo_to_angle</span><span class="p">(</span><span class="n">cur_angle</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer_token</span> <span class="ow">and</span> <span class="n">time_remaining</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">time_total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer_end_time</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="n">time_remaining</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer_end_time</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="n">next_angle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">180</span> <span class="o">*</span> <span class="n">time_remaining</span> <span class="o">/</span> <span class="n">time_total</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cur_angle</span> <span class="o">!=</span> <span class="n">next_angle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_servo_to_angle</span><span class="p">(</span><span class="n">cur_angle</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">cur_angle</span> <span class="o">=</span> <span class="n">next_angle</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="c1"># the timer is expired now, rotate servo back and forth</span>
    <span class="c1"># until timer is cancelled</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer_token</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_servo_to_angle</span><span class="p">(</span><span class="mi">175</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_servo_to_angle</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># the timer was cancelled, reset the servo back to initial state</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_set_servo_to_angle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_set_servo_to_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle_in_degrees</span><span class="p">,</span> <span class="n">timeout</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets the servo to the specified angle. Keep this between 0 and 180</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># set the angle of the Servo (min = -90, max = 90)</span>
    <span class="n">SERVO</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="mi">90</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">angle_in_degrees</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Setting servo to: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">angle_in_degrees</span><span class="p">))</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
    <span class="n">SERVO</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
</pre></div>
</div>
<p>The above callbacks are listening for the set and cleared states of the timer set on the paired Echo device to rotate the servo as an indication that a timer’s duration is incrementing down. When a timer expires, the servo rotates back and forth as an indicator. If a timer is cleared, the servo rotates to its inactive position.</p>
</div>
</div>
<div class="section" id="step-4-test-your-gadget">
<h2>Step 4: Test your gadget<a class="headerlink" href="#step-4-test-your-gadget" title="Permalink to this headline">¶</a></h2>
<p>In order for this gadget to function, it will need to be paired to a <a class="reference external" href="https://developer.amazon.com/docs/alexa-gadgets-toolkit/understand-alexa-gadgets-toolkit.html#devices">compatible Echo device</a>. Before running the example, refer to the <a class="reference external" href="overview.html">pairing guide</a> to learn how to pair your gadget.</p>
<p>With your Echo device nearby, run the Python code:</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">timer_gadget</span><span class="p">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Once your gadget paired/connected, try the following commands:</p>
<p><em>“Alexa, set a 20 second timer”</em></p>
<p>This will cause the servo to rotate to the starting position of the timer, and rotate to home position in sync with the duration of the timer. When the timer runs out, the servo should move back and forth to create a visual indicator that the timer is done.</p>
<p><em>“Alexa, set a timer for 5 minutes”</em></p>
<p><em>“Alexa, clear my timer”</em></p>
<p>The servo shoud rotate to start position and start counting down. When you cancel the timer, the servo should rotate back to home position.</p>
<p>The Pi should print a message whenever the servo runs, and you should see and hear the servo move. Note the direction the servo moves. This will help when assembling the physical components of your gadget.</p>
<blockquote>
<div><p><strong>Note:</strong> While you can set multiple timers on an Echo device, the timer gadget will only show one active timer at a time – the first one that you set.</p>
</div></blockquote>
</div>
<div class="section" id="step-5-assemble-your-gadget">
<h2>Step 5: Assemble your gadget<a class="headerlink" href="#step-5-assemble-your-gadget" title="Permalink to this headline">¶</a></h2>
<p>The housing and disc shown in the image above were constructed from laser-cut wood, but any other objects will work. It also doesn’t have to be a disc at all. Below is a template for the disc and housing of your gadget, which you can print out, transfer to cardboard, and assemble:</p>
<p><a class="reference external" href="_static/pdfs/Timer-Template.pdf">Timer-Template.pdf</a></p>
<a class="reference external image-reference" href="_static/images/timer_template.png"><img alt="Hardware requirements" src="_images/timer_template.png" /></a>
<p>You can use <a class="reference external" href="https://www.youtube.com/watch?v=Gl8i4IYIEXw">this technique</a> to transfer the printed template to cardboard. Once transferred, cut the pieces out and fold to assemble. The disc will need to be attached to the servo using a screw, and the servo can be taped to the cardboard.</p>
<p>Once you have created the housing, place and affix your servo. Make sure to test along the way to make sure the housing and disc are not colliding with other elements when the servo is rotating. You can use the instructions in Step 4 to continually test until your gadget is working just the way you like.</p>
</div>
<div class="section" id="what-s-next">
<h2>What’s next<a class="headerlink" href="#what-s-next" title="Permalink to this headline">¶</a></h2>
<p>You could make a gadget that shows timers in a variety of ways beyond using a disc. You could also use the rotating disc to indicate something other than a timer counting down.</p>
<p>To learn more about Alexa Gadgets Toolkit capabilities, <a class="reference external" href="https://developer.amazon.com/docs/alexa-gadgets-toolkit/features.html">review the documentation</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="notification.html" class="btn btn-neutral float-left" title="Notification Flag Gadget" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, alexa gadgets team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>